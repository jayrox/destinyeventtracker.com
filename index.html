<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Destiny Event Tracker</title>
		<link rel="stylesheet" href="style.css">
		<!-- remove me!!! -->
		<meta http-equiv="refresh" content="300">
	</head>
	<body>
	<div id="main" role="main">
	  <div id="header">
	  	Destiny Event Tracker
	  </div>
	  <div id="bar_container"></div>
	</div>
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>	
	<script>
	  $.getJSON( "timers.json", function( data ) {
	  var bars = [];
	  $.each( data, function( key, val ) {
	    bar = '<div class="bar_group" id="'+val.name+'">';
	    bar +='  <span class="bar_header">'+val.name+'</span>';
	    $.each( val.events, function( e_key, e_val ) {
	      d_offset = 0;
	      d_duration = 300;
	      if (e_val.type == 1) {
	      	d_offset = e_val.intervals[0].start;
	      	d_duration = e_val.intervals[0].end - e_val.intervals[0].start;
	      }
	      bar_description = "";
	      $.each( e_val.subEvents, function( se_key, se_val ) {
		bar_description += se_val;	      	
	      });
	      bar +='  <div class="bar" data-offset="'+d_offset+'" data-duration="'+d_duration+'">';
 	      bar +='    <span class="bar_location">'+e_val.name+'</span>';
	      bar +='    <span class="bar_description">'+bar_description+'</span>';
	      bar +='    <span class="bar_timer">'+e_val.name+'</span>';
	      bar +='  </div>';
	    });
	    bar +='</div';
	    bars.push( bar );
	    console.log(val);
	  });
	 
	  $( "<div/>", {
	    "class": "my-new-list",
	    html: bars.join( "" )
	  }).appendTo( "#bar_container" );
	});
	$(function() {
	function updateAllEvents() {
		$('#bar_container').each(function() {
			var box = $(this);
			var countDown = box.find('.countdown');
			var progressBar = box.find('.progress-bar');
			var eventOffsetData = parseInt(box.data('offset'));
			var eventDurationData = parseInt(box.data('duration'));
		});
	}
	updateAllEvents();    
	setInterval(updateAllEvents, 30 * 1000);
	});
	</script>
	</body>
</html>
